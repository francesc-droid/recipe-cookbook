{% extends "base.html" %}
{% block content %}

    <!--Add and filter buttons-->
    <div class="row add-filter-row">
        <div class="col s12">
            {% if session.user_session %}
                <!--url_for will call the specified function's url which in turn will call the function-->
                <a href="{{ url_for('add_recipe') }}" class="add-filter-btn waves-effect waves-light btn-large yellow accent-4">Add recipe</a>
            {% endif %}
            <a class="add-filter-btn right-float waves-effect waves-light btn-large yellow accent-4" href="{{ url_for('filter_search') }}">Filter</a>
        </div>
    </div>

    <h3 class="center-align home-header">Results Filtered by:</h3>
    <ul class="custom-margin">
        {% for result in final_results %}
                <li class="recipe-li bold larger margin-center green-text darken-4">{{ result.capitalize()|replace("_", " ") }} : {{ final_results[result]|replace("[", "")|replace("]", "")|replace("'", "")|replace("{$nin: ", "")|replace("{$in: ", "")|replace("}", "") }}</li>
        {% endfor %}
    </ul>

    {% if recipes|length > 0 %}
        <div class="row">
            <div class="col s12">
                <p class="bold larger country-margin">{{ recipes|length }} recipes found:</p>
            </div>
        </div>
         <!--Recipe panel-->
        {% for recipe in recipes %}
            <div class="row">
                <div class="col s12 m10 offset-m1">
                    <div class="card-panel recipe-panel yellow accent-4">
                        <div class="col s9">
                            <!--Recipe name-->
                            <p><a href="{{ url_for('recipe_page', recipe_id=recipe._id) }}" class="green-text darken-4 bold larger custom-margin">{{ recipe.recipe_name.capitalize() }}</a> - <em>uploaded by:</em> {{ recipe.created_by }}
                            <!--Recipe high protein icon-->
                            {% if recipe.is_high_protein == "on" %}
                                <i class="fas fa-dumbbell fa-lg protein-icon"></i>
                            {% endif %}
                            <!--Recipe vegan icon-->
                            {% if 'Vegan' in recipe.dietary_requirement %}
                                <i class="fas fa-leaf fa-lg vg-icon"></i>
                            {% endif %}
                            </p>
                        </div>
                        <div class="col s3">
                            {% if session.user_session|lower == recipe.created_by|lower %}
                                <!--This button will send user to edit this recipe page, through the collection value of this recipe _id, which is added as function's argument  -->
                                <a href="{{ url_for('edit_recipe', recipe_id=recipe._id) }}" class="btn-small recipes-buttons light-green darken-2">Edit</a>

                                <!-- Delete confimation Modal Trigger -->
                                <a class="red recipe-buttons btn-small modal-trigger" href="#modal{{ loop.index }}">Delete</a>
                                <!-- Modal Structure -->
                                <div id="modal{{ loop.index }}" class="modal yellow accent-4">
                                    <div class="modal-content">
                                    <h4>Are you sure you want to delete <strong>{{ recipe.recipe_name }}</strong>?</h4>
                                    </div>
                                    <div class="modal-footer yellow accent-4">
                                    <a class="modal-close waves-effect waves-green btn-small red">Cancel</a>
                                    <!--This button will delete this recipe, through the collection value of this recipe _id, which is added as function's argument  -->
                                    <a href="{{ url_for('delete_recipe', recipe_id=recipe._id) }}" class="modal-close waves-effect waves-green btn-small light-green darken-2">Confirm</a>
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        {% endfor %}

    {% else %}
        <h3 class="red-text text-darken-4 center-align">No Results Found</h3>
    {% endif %}
        
{% endblock %}